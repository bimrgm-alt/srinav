<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M2Belt Sync System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --belt-dark: #1a1a1a;
            --belt-texture: #262626;
            --frame-color: #475569;
        }

        body {
            background-color: #0f172a;
            color: #f8fafc;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        .conveyor-container {
            position: relative;
            background: #1e293b;
            padding: 30px 20px;
            border-radius: 16px;
            border: 1px solid #334155;
            box-shadow: inset 0 0 40px rgba(0,0,0,0.3);
        }

        .belt-wrapper {
            position: relative;
            background: #000;
            padding: 4px 0;
            border-top: 6px solid var(--frame-color);
            border-bottom: 6px solid var(--frame-color);
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            margin-bottom: 5px;
        }

        .conveyor-belt {
            height: 70px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
        }

        .belt-texture {
            position: absolute;
            top: 0;
            left: -100px;
            width: calc(100% + 200px);
            height: 100%;
            background-color: var(--belt-dark);
            background-image: 
                linear-gradient(45deg, var(--belt-texture) 25%, transparent 25%), 
                linear-gradient(-45deg, var(--belt-texture) 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, var(--belt-texture) 75%), 
                linear-gradient(-45deg, transparent 75%, var(--belt-texture) 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            opacity: 0.8;
            pointer-events: none;
        }

        .belt-shading {
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.4) 0%, transparent 20%, transparent 80%, rgba(0,0,0,0.4) 100%);
            pointer-events: none;
            z-index: 5;
        }

        .zone-overlay {
            position: absolute;
            top: 0;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 8px;
            font-size: 0.6rem;
            letter-spacing: 0.05em;
            font-weight: 800;
            transition: all 0.3s ease;
            border-right: 1px solid rgba(255,255,255,0.05);
            z-index: 2;
        }

        /* Distinct zone colors */
        .zone-overlay[data-belt="1"][data-zone="1"] { background-color: rgba(59, 130, 246, 0.03); }
        .zone-overlay[data-belt="1"][data-zone="2"] { background-color: rgba(139, 92, 246, 0.03); }
        .zone-overlay[data-belt="1"][data-zone="3"] { background-color: rgba(236, 72, 153, 0.03); }
        .zone-overlay[data-belt="1"][data-zone="4"] { background-color: rgba(245, 158, 11, 0.03); }
        .zone-overlay[data-belt="1"][data-zone="5"] { background-color: rgba(16, 185, 129, 0.03); }
        
        .zone-overlay[data-belt="2"][data-zone="1"] { background-color: rgba(16, 185, 129, 0.03); }
        .zone-overlay[data-belt="2"][data-zone="2"] { background-color: rgba(245, 158, 11, 0.03); }
        .zone-overlay[data-belt="2"][data-zone="3"] { background-color: rgba(236, 72, 153, 0.03); }
        .zone-overlay[data-belt="2"][data-zone="4"] { background-color: rgba(59, 130, 246, 0.03); }

        .zone-active {
            background-color: rgba(255, 255, 255, 0.12) !important;
            box-shadow: inset 0 0 25px rgba(255,255,255,0.08);
            color: #fff;
        }

        .product {
            position: absolute;
            width: 44px;
            height: 44px;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 0.6rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.6), inset 0 1px 1px rgba(255,255,255,0.3);
            z-index: 10;
            transition: transform 0.1s linear; 
            will-change: transform;
            text-align: center;
            overflow: hidden;
            padding: 2px;
            color: #ffffff; 
            border: 1px solid rgba(255,255,255,0.2);
        }

        .uturn-indicator {
            height: 50px;
            background: #0f172a;
            border: 2px solid #334155;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            border-radius: 8px;
            color: #94a3b8;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.5);
        }

        #inputModal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
            backdrop-filter: blur(8px);
        }

        /* Notification Styling */
        #notification-center {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 500;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .notif-toast {
            background: #1e293b;
            border-left: 4px solid #f59e0b;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.5);
            animation: slideIn 0.3s ease-out;
            min-width: 250px;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="notification-center"></div>

    <!-- Modal for Loading Product -->
    <div id="inputModal">
        <div class="bg-slate-800 p-8 rounded-2xl border border-slate-700 w-full max-w-md shadow-2xl">
            <h3 class="text-2xl font-black mb-6 text-blue-400 italic">LOAD NEW UNIT</h3>
            <div class="space-y-5">
                <div>
                    <label class="block text-[10px] font-black text-slate-400 uppercase mb-1">Product Name (Must be 1 or 2)</label>
                    <input type="text" id="modalProdName" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 outline-none text-white font-bold" placeholder="1 or 2">
                    <p id="errorName" class="text-red-500 text-[10px] mt-1 font-bold hidden">Invalid Name! Only "1" or "2" allowed.</p>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[10px] font-black text-slate-400 uppercase mb-1">Start Time (Optional)</label>
                        <input type="time" id="modalStartTime" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-white">
                    </div>
                    <div>
                        <label class="block text-[10px] font-black text-slate-400 uppercase mb-1">Target Exit (Optional)</label>
                        <input type="time" id="modalFinishTime" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-white">
                    </div>
                </div>
                <div class="flex gap-4 pt-4">
                    <button id="cancelLoad" class="flex-1 px-4 py-3 rounded-xl bg-slate-700 font-black text-slate-300 uppercase tracking-tighter">Cancel</button>
                    <button id="confirmLoad" class="flex-1 px-4 py-3 rounded-xl bg-blue-600 font-black text-white shadow-lg shadow-blue-500/20 uppercase tracking-tighter">Confirm Load</button>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto">
        <header class="mb-8 border-b border-slate-700 pb-6 flex flex-col md:flex-row justify-between items-end gap-4">
            <div>
                <div class="flex items-center gap-3">
                    <span class="text-3xl font-black tracking-tighter text-blue-500 italic">M2Belt</span>
                </div>
                <p class="text-slate-500 font-medium text-sm">Persistent Multi-Unit Synchronization</p>
            </div>
            
            <div class="flex flex-wrap items-center gap-6 bg-slate-900/50 p-4 rounded-xl border border-slate-800">
                <div>
                    <label class="block text-[10px] uppercase text-slate-500 font-black mb-1">HQ Speed (mm/min)</label>
                    <div class="flex items-center gap-3">
                        <input type="range" id="speedSlider1" min="66" max="230" class="w-32 accent-blue-500">
                        <span class="text-xl font-mono text-blue-400 w-10 text-right" id="speedVal1"></span>
                    </div>
                </div>
                <div>
                    <label class="block text-[10px] uppercase text-slate-500 font-black mb-1">HT Speed (mm/min)</label>
                    <div class="flex items-center gap-3">
                        <input type="range" id="speedSlider2" min="120" max="144" class="w-32 accent-green-500">
                        <span class="text-xl font-mono text-green-400 w-10 text-right" id="speedVal2"></span>
                    </div>
                </div>
                
                <button id="openModal" class="bg-blue-600 hover:bg-blue-500 text-white px-8 py-3 rounded-lg font-black uppercase tracking-tighter transition-all active:scale-95">
                    Add Product
                </button>
            </div>
        </header>

        <div class="conveyor-container mb-8">
            <div class="mb-3 flex justify-between text-[10px] text-slate-400 font-black uppercase tracking-widest px-1">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-blue-500 animate-pulse"></div>
                    HEAT QUENCHING (7980mm)
                </div>
                <span id="pCount" class="bg-blue-900/40 px-2 py-0.5 rounded text-blue-300">Units: 0</span>
            </div>
            
            <div class="belt-wrapper">
                <div class="conveyor-belt" id="belt1">
                    <div class="belt-texture" id="texture1"></div>
                    <div class="belt-shading"></div>
                    <div class="zone-overlay" style="left: 0%; width: 20%;" data-belt="1" data-zone="1"><span>ZONE 1</span></div>
                    <div class="zone-overlay" style="left: 20%; width: 20%;" data-belt="1" data-zone="2"><span>ZONE 2</span></div>
                    <div class="zone-overlay" style="left: 40%; width: 20%;" data-belt="1" data-zone="3"><span>ZONE 3</span></div>
                    <div class="zone-overlay" style="left: 60%; width: 20%;" data-belt="1" data-zone="4"><span>ZONE 4</span></div>
                    <div class="zone-overlay" style="left: 80%; width: 20%;" data-belt="1" data-zone="5"><span>ZONE 5</span></div>
                </div>
            </div>

            <div class="uturn-indicator">
                <svg class="w-5 h-5 mr-3 text-blue-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/><path d="M12 7v5l3 3"/></svg>
                Buffer Zone (25 min Delay) <span id="uturnCount" class="ml-3 text-white bg-blue-600 px-3 py-0.5 rounded-full text-xs">0</span>
            </div>

            <div class="mb-3 flex justify-between text-[10px] text-slate-400 font-black uppercase tracking-widest px-1">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                    HEAT TEMPERING (7200mm)
                </div>
                <span id="rCount" class="bg-green-900/40 px-2 py-0.5 rounded text-green-300">Units: 0</span>
            </div>
            
            <div class="belt-wrapper">
                <div class="conveyor-belt" id="belt2">
                    <div class="belt-texture" id="texture2"></div>
                    <div class="belt-shading"></div>
                    <div class="zone-overlay" style="left: 0%; width: 25%;" data-belt="2" data-zone="1"><span>ZONE 1</span></div>
                    <div class="zone-overlay" style="left: 25%; width: 25%;" data-belt="2" data-zone="2"><span>ZONE 2</span></div>
                    <div class="zone-overlay" style="left: 50%; width: 25%;" data-belt="2" data-zone="3"><span>ZONE 3</span></div>
                    <div class="zone-overlay" style="left: 75%; width: 25%;" data-belt="2" data-zone="4"><span>ZONE 4</span></div>
                </div>
            </div>
        </div>

        <div class="bg-slate-900/80 rounded-2xl border border-slate-800 overflow-hidden shadow-2xl">
            <table class="w-full text-xs text-left">
                <thead class="bg-slate-800/50 text-slate-500 uppercase font-black tracking-widest">
                    <tr>
                        <th class="px-6 py-4">ID / Product Name</th>
                        <th class="px-6 py-4">Start / Exit Times</th>
                        <th class="px-6 py-4 text-center">Current Position</th>
                        <th class="px-6 py-4">Status</th>
                        <th class="px-6 py-4 text-right">Metrics</th>
                    </tr>
                </thead>
                <tbody id="trackingBody"></tbody>
            </table>
            <div id="emptyState" class="p-12 text-center text-slate-600 font-medium italic">Active pipeline empty. Load a unit to track.</div>
        </div>
    </div>

    <script>
        const P_LENGTH = 7980; 
        const R_LENGTH = 7200; 
        const UTURN_MS = 25 * 60 * 1000; 

        // DOM
        const speedS1 = document.getElementById('speedSlider1');
        const speedS2 = document.getElementById('speedSlider2');
        const trackingBody = document.getElementById('trackingBody');
        const emptyState = document.getElementById('emptyState');
        const openModalBtn = document.getElementById('openModal');
        const inputModal = document.getElementById('inputModal');
        const cancelLoad = document.getElementById('cancelLoad');
        const confirmLoad = document.getElementById('confirmLoad');
        const modalProdName = document.getElementById('modalProdName');
        const errorName = document.getElementById('errorName');
        const notifContainer = document.getElementById('notification-center');

        // Storage initialization
        const savedProducts = JSON.parse(localStorage.getItem('m2belt_products') || '[]');
        const savedCounter = parseInt(localStorage.getItem('m2belt_counter') || '1');
        const savedSpeedP = localStorage.getItem('m2belt_speedP') || '177';
        const savedSpeedR = localStorage.getItem('m2belt_speedR') || '120';
        
        speedS1.value = savedSpeedP;
        speedS2.value = savedSpeedR;

        const state = {
            speedP: parseInt(savedSpeedP), 
            speedR: parseInt(savedSpeedR), 
            products: savedProducts,
            counter: savedCounter,
            lastFrameTime: performance.now(),
            textureOffsets: [0, 0]
        };

        function notify(msg) {
            const toast = document.createElement('div');
            toast.className = 'notif-toast';
            toast.innerHTML = `<div class="text-[10px] font-black text-amber-500 uppercase tracking-widest mb-1">BAR TIME ALERT</div>
                               <div class="text-white font-bold text-sm">${msg}</div>`;
            notifContainer.appendChild(toast);
            setTimeout(() => toast.remove(), 6000);
        }

        function saveToStorage() {
            const cleanData = state.products.map(p => ({
                id: p.id,
                name: p.name,
                stage: p.stage,
                startTime: p.startTime,
                returnStartTime: p.returnStartTime,
                uturnStart: p.uturnStart,
                currentPos: p.currentPos,
                entryClock: p.entryClock,
                exitClock: p.exitClock,
                color: p.color,
                notified15: p.notified15,
                notified10: p.notified10
            }));
            localStorage.setItem('m2belt_products', JSON.stringify(cleanData));
            localStorage.setItem('m2belt_counter', state.counter.toString());
            localStorage.setItem('m2belt_speedP', state.speedP.toString());
            localStorage.setItem('m2belt_speedR', state.speedR.toString());
        }

        speedS1.addEventListener('input', (e) => { state.speedP = parseInt(e.target.value); saveToStorage(); });
        speedS2.addEventListener('input', (e) => { state.speedR = parseInt(e.target.value); saveToStorage(); });

        function syncProgress(p) {
            const now = Date.now();
            if (p.stage === 'p-belt') {
                const elapsedMin = (now - p.startTime) / 60000;
                const dist = state.speedP * elapsedMin;
                return { dist: Math.min(dist, P_LENGTH), isFin: dist >= P_LENGTH, rem: Math.max(0, (P_LENGTH - dist) / state.speedP) };
            } else if (p.stage === 'r-belt') {
                const elapsedMin = (now - p.returnStartTime) / 60000;
                const dist = state.speedR * elapsedMin;
                return { dist: Math.min(dist, R_LENGTH), isFin: dist >= R_LENGTH, rem: Math.max(0, (R_LENGTH - dist) / state.speedR) };
            }
            return { dist: 0, isFin: false, rem: 0 };
        }

        // Modal Logic
        openModalBtn.addEventListener('click', () => { 
            inputModal.style.display = 'flex'; 
            errorName.classList.add('hidden');
        });
        cancelLoad.addEventListener('click', () => { inputModal.style.display = 'none'; });
        
        confirmLoad.addEventListener('click', () => {
            const nameValue = modalProdName.value.trim();
            if (nameValue !== "1" && nameValue !== "2") {
                errorName.classList.remove('hidden');
                return;
            }

            const startOver = document.getElementById('modalStartTime').value;
            const endOver = document.getElementById('modalFinishTime').value;

            let now = Date.now();
            if (startOver) {
                const [h, m] = startOver.split(':');
                const d = new Date(); d.setHours(h, m, 0, 0);
                now = d.getTime();
            }

            const hqDur = (P_LENGTH / state.speedP) * 60000;
            const htDur = (R_LENGTH / state.speedR) * 60000;
            let estExit = now + hqDur + UTURN_MS + htDur;

            if (endOver) {
                const [h, m] = endOver.split(':');
                const d = new Date(); d.setHours(h, m, 0, 0);
                estExit = d.getTime();
            }

            let prodColor = "#22c55e"; 
            if (state.products.length === 1) {
                prodColor = "#ef4444"; 
            } else if (state.products.length >= 2) {
                prodColor = (state.products.length % 2 === 0) ? "#22c55e" : "#ef4444";
            }

            const cycleId = `U${nameValue}`; 

            state.products.push({
                id: cycleId, 
                name: nameValue,
                stage: 'p-belt',
                startTime: now,
                returnStartTime: null,
                uturnStart: null,
                currentPos: 0,
                entryClock: now,
                exitClock: estExit,
                element: null,
                color: prodColor,
                notified15: false,
                notified10: false
            });

            modalProdName.value = '';
            inputModal.style.display = 'none';
            saveToStorage();
            updateEmptyState();
        });

        function formatClock(ts) {
            if (!ts) return "--:--";
            return new Date(ts).toLocaleTimeString([], { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
        }

        function formatTimeRemaining(m) {
            const mins = Math.floor(m);
            const secs = Math.floor((m % 1) * 60);
            return `${mins}m ${secs}s`;
        }

        function animate(frameTime) {
            const now = Date.now();
            const dt = frameTime - state.lastFrameTime;
            state.lastFrameTime = frameTime;

            document.getElementById('speedVal1').innerText = state.speedP;
            document.getElementById('speedVal2').innerText = state.speedR;

            state.textureOffsets[0] = (state.textureOffsets[0] + (state.speedP / 12000) * dt) % 40;
            state.textureOffsets[1] = (state.textureOffsets[1] - (state.speedR / 12000) * dt) % 40;
            document.getElementById('texture1').style.transform = `translateX(${state.textureOffsets[0]}px)`;
            document.getElementById('texture2').style.transform = `translateX(${state.textureOffsets[1]}px)`;

            const activeP = new Set();
            const activeR = new Set();
            let uturnCount = 0;
            let stateChanged = false;

            for (let i = state.products.length - 1; i >= 0; i--) {
                const p = state.products[i];
                const sync = syncProgress(p);

                if (p.stage === 'p-belt') {
                    p.currentPos = sync.dist;
                    activeP.add(Math.min(Math.floor(p.currentPos / (P_LENGTH / 5)) + 1, 5));
                    
                    if (!p.element) {
                        p.element = document.createElement('div');
                        p.element.className = 'product';
                        document.getElementById('belt1').appendChild(p.element);
                    }
                    p.element.style.backgroundColor = p.color;
                    p.element.innerHTML = `<span class="opacity-60 text-[7px] font-black">${p.id}</span><span class="font-black text-[12px] truncate w-full px-1">${p.name}</span>`;
                    
                    const pct = (p.currentPos / P_LENGTH);
                    p.element.style.transform = `translateX(${pct * (document.getElementById('belt1').offsetWidth - 44)}px)`;

                    if (sync.isFin) {
                        p.stage = 'u-turn';
                        p.uturnStart = p.startTime + ((P_LENGTH / state.speedP) * 60000);
                        if (p.element) { p.element.remove(); p.element = null; }
                        stateChanged = true;
                    }
                } 
                else if (p.stage === 'u-turn') {
                    uturnCount++;
                    const msLeft = UTURN_MS - (now - p.uturnStart);
                    const minLeft = msLeft / 60000;

                    // Trigger BAR TIME notifications
                    if (minLeft <= 15 && minLeft > 14.5 && !p.notified15) {
                        notify(`Product ${p.name} (${p.id}): BAR TIME - 15m until exit.`);
                        p.notified15 = true;
                        stateChanged = true;
                    }
                    if (minLeft <= 10 && minLeft > 9.5 && !p.notified10) {
                        notify(`Product ${p.name} (${p.id}): BAR TIME - 10m until exit.`);
                        p.notified10 = true;
                        stateChanged = true;
                    }

                    if (msLeft <= 0) {
                        p.stage = 'r-belt';
                        p.returnStartTime = p.uturnStart + UTURN_MS;
                        stateChanged = true;
                    }
                } 
                else if (p.stage === 'r-belt') {
                    p.currentPos = sync.dist;
                    activeR.add(Math.min(Math.floor(p.currentPos / (R_LENGTH / 4)) + 1, 4));

                    if (!p.element) {
                        p.element = document.createElement('div');
                        p.element.className = 'product';
                        document.getElementById('belt2').appendChild(p.element);
                    }
                    p.element.style.backgroundColor = p.color;
                    p.element.innerHTML = `<span class="opacity-60 text-[7px] font-black">${p.id}</span><span class="font-black text-[12px] truncate w-full px-1">${p.name}</span>`;
                    
                    const pct = (p.currentPos / R_LENGTH);
                    const bWidth = document.getElementById('belt2').offsetWidth;
                    p.element.style.transform = `translateX(${(bWidth - 44) - (pct * (bWidth - 44))}px)`;

                    if (sync.isFin) {
                        if (p.element) p.element.remove();
                        state.products.splice(i, 1);
                        stateChanged = true;
                        updateEmptyState();
                    }
                }
            }

            if (stateChanged) saveToStorage();
            updateZones(activeP, activeR);
            document.getElementById('uturnCount').innerText = uturnCount;
            document.getElementById('pCount').innerText = `Units: ${state.products.filter(x => x.stage === 'p-belt').length}`;
            document.getElementById('rCount').innerText = `Units: ${state.products.filter(x => x.stage === 'r-belt').length}`;

            if (state.products.length > 0) renderTable();
            requestAnimationFrame(animate);
        }

        function updateZones(activeP, activeR) {
            document.querySelectorAll('.zone-overlay').forEach(el => {
                const b = el.dataset.belt;
                const z = parseInt(el.dataset.zone);
                if ((b == "1" && activeP.has(z)) || (b == "2" && activeR.has(z))) el.classList.add('zone-active');
                else el.classList.remove('zone-active');
            });
        }

        function renderTable() {
            let html = '';
            const now = Date.now();
            state.products.forEach(p => {
                const sync = syncProgress(p);
                let status = `<span class="bg-blue-900/40 text-blue-400 px-2 py-0.5 rounded font-black tracking-tighter">HQ BELT</span>`;
                let remTxt = formatTimeRemaining(sync.rem);

                if (p.stage === 'u-turn') {
                    status = `<span class="bg-amber-900/40 text-amber-400 px-2 py-0.5 rounded font-black tracking-tighter">BUFFER</span>`;
                    remTxt = formatTimeRemaining((UTURN_MS - (now - p.uturnStart)) / 60000);
                } else if (p.stage === 'r-belt') {
                    status = `<span class="bg-green-900/40 text-green-400 px-2 py-0.5 rounded font-black tracking-tighter">HT BELT</span>`;
                }

                html += `<tr class="border-t border-slate-800/50 hover:bg-white/5 transition-colors">
                    <td class="px-6 py-4">
                        <div class="font-black text-slate-200 tracking-tighter leading-none flex items-center gap-2">
                            <div class="w-2 h-2 rounded-full" style="background-color: ${p.color}"></div>
                            ${p.name}
                        </div>
                        <div class="text-[9px] text-slate-500 font-bold mt-1 uppercase tracking-widest ml-4">${p.id}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-blue-400 font-mono text-[11px] font-bold">START: ${formatClock(p.entryClock)}</div>
                        <div class="text-green-400 font-mono text-[11px] font-bold mt-1">EXIT: ${formatClock(p.exitClock)}</div>
                    </td>
                    <td class="px-6 py-4 text-center font-mono text-slate-400">${p.stage === 'u-turn' ? 'BUFFERING' : p.currentPos.toFixed(0) + ' mm'}</td>
                    <td class="px-6 py-4">${status}</td>
                    <td class="px-6 py-4 text-right font-mono text-slate-500">${remTxt}</td>
                </tr>`;
            });
            trackingBody.innerHTML = html;
        }

        function updateEmptyState() { emptyState.style.display = state.products.length === 0 ? 'block' : 'none'; }
        
        updateEmptyState();
        requestAnimationFrame(animate);
    </script>
</body>
</html>
